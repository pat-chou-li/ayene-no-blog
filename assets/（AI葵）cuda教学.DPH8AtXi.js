import{_ as g}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BroTQeye.js";import"./chunks/@vueuse/motion.CDGXpttC.js";import{e as c,u as y,a as o}from"./chunks/vue-router.DlUPz4t8.js";import{aa as F,ap as a,ag as t,af as s,ai as i,O as u,ab as C,a1 as A}from"./framework.BWK1Zvdg.js";import"./app.5Pc5wqE0.js";import"./chunks/dayjs.BldX5ftQ.js";import"./chunks/vue-i18n.lF0SUo7_.js";import"./chunks/pinia.BYsrTFz1.js";/* empty css                    */import"./chunks/nprogress.DxEoPAls.js";import"./YunComment.vue_vue_type_style_index_0_lang.BTzG1k4p.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.DB3O5jFY.js";import"./post.B8Hql8K0.js";const D="/ayene-no-blog/assets/image-20240303133950997.jJ9o6vj3.png",_="/ayene-no-blog/assets/image-20240303160824172.DRg7TDlB.png",f="/ayene-no-blog/assets/image-20240303170057260.DXDhnvVm.png",B=c("/posts/（AI葵）cuda教学",async h=>JSON.parse('{"title":"（AI葵）cuda教学","description":"","frontmatter":{"title":"（AI葵）cuda教学","date":"2024.3.3","categories":"CUDA/CPP","tags":["图形学","NeRF","3DGS"]},"headers":[],"relativePath":"pages/posts/（AI葵）cuda教学.md","lastUpdated":1755853346000}'),{lazy:(h,n)=>h.name===n.name}),L={__name:"（AI葵）cuda教学",setup(h,{expose:n}){const{data:e}=B(),r=o(),E=y(),k=Object.assign(E.meta.frontmatter||{},e.value?.frontmatter||{});return r.currentRoute.value.data=e.value,A("valaxy:frontmatter",k),globalThis.$frontmatter=k,n({frontmatter:{title:"（AI葵）cuda教学",date:"2024.3.3",categories:"CUDA/CPP",tags:["图形学","NeRF","3DGS"]}}),(l,p)=>{const d=g;return C(),F(d,{frontmatter:u(k)},{"main-content-md":a(()=>[...p[0]||(p[0]=[s("h2",{id:"tutorial-1-setup",tabindex:"-1"},[i("Tutorial 1 setup "),s("a",{class:"header-anchor",href:"#tutorial-1-setup","aria-label":'Permalink to "Tutorial 1 setup"'},"​")],-1),s("ul",null,[s("li",null,[s("p",null,"使用方法：在python中调用cpp，在cpp中调用cuda")]),s("li",null,[s("p",null,"哪些时候要用到CUDA，pytorch无法自动实现？"),s("ul",null,[s("li",null,[s("p",null,"非平行运算，例如体渲染，采样点不一样")]),s("li",null,[s("p",null,"大量的串行运算"),s("img",{src:D,alt:"image-20240303133950997",style:{zoom:"50%"}})])])])],-1),s("p",null,"windos下cpp中添加torch头文件",-1),s("blockquote",null,[s("p",null,'"C:/Users/Patchouli/anaconda3/envs/cppcuda/include",'),s("p",null,'"C:/Users/Patchouli/anaconda3/envs/cppcuda/Lib/site-packages/torch/include",'),s("p",null,'"C:/Users/Patchouli/anaconda3/envs/cppcuda/Lib/site-packages/torch/include/torch/csrc/api/include"')],-1),s("p",null,"pybind：从python中调用cpp",-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"PYBIND11_MODULE(TORCH_EXTENSION_NAME, m){")]),i(`
`),s("span",{class:"line"},[s("span",null,'    m.def("_trilinear_interpolation", &_trilinear_interpolation) ')]),i(`
`),s("span",{class:"line"},[s("span",null,"    #前者定义python中的函数名称，后者是cpp中调用的函数")]),i(`
`),s("span",{class:"line"},[s("span",null,"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"CPP文件需要编译才能运行，这里由python进行注册，在setup.py文件中",-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"import glob")]),i(`
`),s("span",{class:"line"},[s("span",null,"import os.path as osp")]),i(`
`),s("span",{class:"line"},[s("span",null,"from setuptools import setup")]),i(`
`),s("span",{class:"line"},[s("span",null,"from torch.utils.cpp_extension import CUDAExtension, BuildExtension")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"ROOT_DIR = osp.dirname(osp.abspath(__file__))")]),i(`
`),s("span",{class:"line"},[s("span",null,'include_dirs = [osp.join(ROOT_DIR, "include")]')]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"sources = glob.glob('*.cpp')+glob.glob('*.cu')")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"setup(")]),i(`
`),s("span",{class:"line"},[s("span",null,"    name='cppcuda_tutorial', #import时的名称")]),i(`
`),s("span",{class:"line"},[s("span",null,"    version='1.0',")]),i(`
`),s("span",{class:"line"},[s("span",null,"    author='kwea123',")]),i(`
`),s("span",{class:"line"},[s("span",null,"    author_email='kwea123@gmail.com',")]),i(`
`),s("span",{class:"line"},[s("span",null,"    description='cppcuda_tutorial',")]),i(`
`),s("span",{class:"line"},[s("span",null,"    long_description='cppcuda_tutorial',")]),i(`
`),s("span",{class:"line"},[s("span",null,"    ext_modules=[")]),i(`
`),s("span",{class:"line"},[s("span",null,"        CUDAExtension(")]),i(`
`),s("span",{class:"line"},[s("span",null,"            name='cppcuda_tutorial',")]),i(`
`),s("span",{class:"line"},[s("span",null,"            sources=sources,        # 有哪些cpp/cu文件需要build")]),i(`
`),s("span",{class:"line"},[s("span",null,"            include_dirs=include_dirs,")]),i(`
`),s("span",{class:"line"},[s("span",null,"            extra_compile_args={'cxx': ['-O2'],")]),i(`
`),s("span",{class:"line"},[s("span",null,"                                'nvcc': ['-O2']}")]),i(`
`),s("span",{class:"line"},[s("span",null,"        )")]),i(`
`),s("span",{class:"line"},[s("span",null,"    ],")]),i(`
`),s("span",{class:"line"},[s("span",null,"    cmdclass={")]),i(`
`),s("span",{class:"line"},[s("span",null,"        'build_ext': BuildExtension")]),i(`
`),s("span",{class:"line"},[s("span",null,"    }")]),i(`
`),s("span",{class:"line"},[s("span",null,")")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"写好setup.python后，执行以下代码编译cpp",-1),s("blockquote",null,[s("p",null,"python setup.py install")],-1),s("p",null,"在python中就可以使用cpp代码了",-1),s("blockquote",null,[s("p",null,"import torch"),s("p",null,"import cppcuda_tutorial"),s("p",null,"feats = torch.ones(2)"),s("p",null,"points = torch.zeros(2)"),s("p",null,"out = cppcuda_tutorial._trilinear_interpolation(feats, points)"),s("p",null,"print(out)")],-1),s("h2",{id:"tutorial-2-input-check",tabindex:"-1"},[i("Tutorial 2 input check "),s("a",{class:"header-anchor",href:"#tutorial-2-input-check","aria-label":'Permalink to "Tutorial 2 input check"'},"​")],-1),s("p",null,"grid->block->thread",-1),s("p",null,"三线性插值中有哪些能平行运算？",-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"#include <torch/extension.h>")]),i(`
`),s("span",{class:"line"},[s("span",null,"torch::Tensor _trilinear_interpolation(")]),i(`
`),s("span",{class:"line"},[s("span",null,"    torch::Tensor feats, //(N, 8, F) N: 正方体数量， 8个顶点， F个feature")]),i(`
`),s("span",{class:"line"},[s("span",null,"    torch::Tensor point  //(N, 3) 三维坐标")]),i(`
`),s("span",{class:"line"},[s("span",null,"){")]),i(`
`),s("span",{class:"line"},[s("span",null,"    return feats;")]),i(`
`),s("span",{class:"line"},[s("span",null,"}")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"PYBIND11_MODULE(TORCH_EXTENSION_NAME, m){")]),i(`
`),s("span",{class:"line"},[s("span",null,'    m.def("_trilinear_interpolation", &_trilinear_interpolation);')]),i(`
`),s("span",{class:"line"},[s("span",null,"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"N个正方体之间可以平行",-1),s("p",null,"F个feature之间可以平行",-1),s("blockquote",null,[s("p",null,"8个顶点不也能平行运算吗")],-1),s("p",null,"在调用cuda，将tensor传入前，必须做的检测",-1),s("div",{class:"language-cpp"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"cpp"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    CHECK_INPUT"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(feats);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    CHECK_INPUT"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(points);")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#define"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," CHECK_CUDA"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"x"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"TORCH_CHECK"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(x."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"is_cuda"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), #x "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" must be a CUDA tensor"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#define"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," CHECK_CONTIGUOUS"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"x"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"TORCH_CHECK"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(x."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"is_contiguous"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), #x "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" must be contiguous"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#define"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," CHECK_INPUT"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"x"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"CHECK_CUDA"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(x); "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"CHECK_CONTIGUOUS"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(x)")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"大概就是检测tensor是不是在cuda上，和内存上是否连续，注意floater之类的参数就不要检测了，主要是tensor",-1),s("h2",{id:"tutorial-3-定义thread",tabindex:"-1"},[i("Tutorial 3 定义thread "),s("a",{class:"header-anchor",href:"#tutorial-3-定义thread","aria-label":'Permalink to "Tutorial 3 定义thread"'},"​")],-1),s("img",{src:_,alt:"image-20240303160824172",style:{zoom:"50%"}},null,-1),s("p",null,"一个block中有多少thread由我们自行定义，有几个block一般由一个公式固定计算",-1),s("p",null,"例如有20个立方体，每个立方体要计算10个feature，我们定义的线程中行表示不同立方体，列表示不同feature，用1个含有16*16个thread的block，则需要两个block才能将20*10包含住，2行1列block。",-1),s("div",{class:"language-c++"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"c++"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // torch.zeros(N, F, dtype=torch.float32, device='cuda:0')")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::Tensor feat_interp "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"zeros"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"({N, F}, feats."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"options"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // torch::zeros({N, F}, torch::dtype(torch::kInt32).device(feats.device));")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," dim3"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," threads"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," // N and F平行运算，各16个，共有256个线程")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," dim3"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," blocks"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"((N"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"threads.x"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"threads"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"x"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", (F"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"threads.y"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"threads"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"y"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"接下来要启动一个kernal,让数据在GPU上运算，举例代码如下",-1),s("div",{class:"language-c++"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"c++"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    AT_DISPATCH_FLOATING_TYPES"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(feats."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"type"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"trilinear_fw_cu"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    (["),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        trilinear_fw_kernel"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"><<<"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"blocks, threads"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            feats.packed_accessor"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::RestrictPtrTraits, "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"size_t>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            points.packed_accessor"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::RestrictPtrTraits, "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"size_t>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            feat_interp.packed_accessor"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::RestrictPtrTraits, "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"size_t>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        );")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }));")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"tutorial-4-调用kernal",tabindex:"-1"},[i("Tutorial 4 调用kernal "),s("a",{class:"header-anchor",href:"#tutorial-4-调用kernal","aria-label":'Permalink to "Tutorial 4 调用kernal"'},"​")],-1),s("p",null,"核函数的写法：",-1),s("p",null,"step1：计算出thread的编号，之后写每个thread要做什么",-1),s("div",{class:"language-c++"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"c++"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 二维thread，计算编号    ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," blockIdx.x "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," blockDim.x "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," threadIdx.x;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," blockIdx.y "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," blockDim.y "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," threadIdx.y;")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"step2：去除不必要的thread，图中橙色部分就是不必要的thread",-1),s("img",{src:f,alt:"image-20240303170057260",style:{zoom:"50%"}},null,-1),s("div",{class:"language-c++"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"c++"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"最后cuda代码如下：",-1),s("div",{class:"language-c++"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"c++"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#include"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," <torch/extension.h>")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"template"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," <"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"typename"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// __global__ ：在CPU上调用，在GPU上执行")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// __host__ : 在CPU上执行")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// __device__ : 在GPU上调用，在GPU上执行")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"__global__ "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," trilinear_fw_kernel"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::PackedTensorAccessor"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::RestrictPtrTraits, "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"size_t>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," feats,")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::PackedTensorAccessor"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::RestrictPtrTraits, "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"size_t>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," points,")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::PackedTensorAccessor"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::RestrictPtrTraits, "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"size_t>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," feat_interp")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 计算出thread的编号，接下来写每个thread要做的事")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," blockIdx.x "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," blockDim.x "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," threadIdx.x;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," blockIdx.y "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," blockDim.y "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," threadIdx.y;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 去除不必要的thread")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // point -1~1，normalization")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," u "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (points[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (points[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," w "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (points[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," a "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"v)"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"w);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"v)"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"w;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"w);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," d "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"a"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"b"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"c;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    feat_interp[n][f] "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"u)"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(a"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"][f] "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                               b"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"][f] "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                               c"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"][f] "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                               d"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"][f]) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            u"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(a"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"4"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"][f] "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                               b"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"][f] "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                               c"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"6"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"][f] "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                               d"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"feats[n]["),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"7"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"][f]);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Tensor"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," trilinear_fw_cu"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Tensor"),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," feats"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //(N, 8, F) N: 正方体数量， 8个顶点， F个feature")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Tensor"),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," points"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  //(N, 3) 三维坐标")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," N "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," feats."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"), F "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," feats."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // torch.zeros(N, F, dtype=torch.float32, device='cuda:0')")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::Tensor feat_interp "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"zeros"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"({N, F}, feats."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"options"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // torch::zeros({N, F}, torch::dtype(torch::kInt32).device(feats.device));")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," dim3 "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"threads"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," // N and F平行运算，各16个，共有256个线程")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," dim3 "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"blocks"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"((N"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"threads.x"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"threads.x, (F"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"threads.y"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"threads.y);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // CPU上调用核函数，进行GPU计算")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    AT_DISPATCH_FLOATING_TYPES"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(feats."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"type"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"trilinear_fw_cu"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    (["),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // trilinear_fw_kernel : 自定义的kernal函数的名字")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // scalar_t : 数据类型")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        trilinear_fw_kernel"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"><<<"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"blocks, threads"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 要丢进kernal的三个数据，input和output都要丢进去，kernal函数没有回传")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // .packed_accessor 将tensor转化为cuda认识的形态")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // first parametre  : 数据类型")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // second parametre : tensor的维度，比如说feats是（N, 8, F），所以有3维")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // thrid parameter  : 指定各个参数内存上没有交集（大概是 用到再查）")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            feats.packed_accessor"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::RestrictPtrTraits, "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"size_t>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            points.packed_accessor"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::RestrictPtrTraits, "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"size_t>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            feat_interp.packed_accessor"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"scalar_t"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::RestrictPtrTraits, "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"size_t>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        );")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }));")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," feat_interp;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"tutorial-5-python验证",tabindex:"-1"},[i("Tutorial 5 python验证 "),s("a",{class:"header-anchor",href:"#tutorial-5-python验证","aria-label":'Permalink to "Tutorial 5 python验证"'},"​")],-1),s("p",null,"可以用python写一遍，然后用来对比cuda程序的正确性，以及加速效率",-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"import torch")]),i(`
`),s("span",{class:"line"},[s("span",null,"import cppcuda_tutorial")]),i(`
`),s("span",{class:"line"},[s("span",null,"import time")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"def trilinear_interpolation_py(feats, points):")]),i(`
`),s("span",{class:"line"},[s("span",null,'    """')]),i(`
`),s("span",{class:"line"},[s("span",null,"    Inputs:")]),i(`
`),s("span",{class:"line"},[s("span",null,"        feats: (N, 8, F)")]),i(`
`),s("span",{class:"line"},[s("span",null,"        points: (N, 3) local coordinates in [-1, 1]")]),i(`
`),s("span",{class:"line"},[s("span",null,"    ")]),i(`
`),s("span",{class:"line"},[s("span",null,"    Outputs:")]),i(`
`),s("span",{class:"line"},[s("span",null,"        feats_interp: (N, F)")]),i(`
`),s("span",{class:"line"},[s("span",null,'    """')]),i(`
`),s("span",{class:"line"},[s("span",null,"    u = (points[:, 0:1]+1)/2")]),i(`
`),s("span",{class:"line"},[s("span",null,"    v = (points[:, 1:2]+1)/2")]),i(`
`),s("span",{class:"line"},[s("span",null,"    w = (points[:, 2:3]+1)/2")]),i(`
`),s("span",{class:"line"},[s("span",null,"    a = (1-v)*(1-w)")]),i(`
`),s("span",{class:"line"},[s("span",null,"    b = (1-v)*w")]),i(`
`),s("span",{class:"line"},[s("span",null,"    c = v*(1-w)")]),i(`
`),s("span",{class:"line"},[s("span",null,"    d = 1-a-b-c")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"    feats_interp = (1-u)*(a*feats[:, 0] +")]),i(`
`),s("span",{class:"line"},[s("span",null,"                          b*feats[:, 1] +")]),i(`
`),s("span",{class:"line"},[s("span",null,"                          c*feats[:, 2] +")]),i(`
`),s("span",{class:"line"},[s("span",null,"                          d*feats[:, 3]) + \\")]),i(`
`),s("span",{class:"line"},[s("span",null,"                       u*(a*feats[:, 4] +")]),i(`
`),s("span",{class:"line"},[s("span",null,"                          b*feats[:, 5] +")]),i(`
`),s("span",{class:"line"},[s("span",null,"                          c*feats[:, 6] +")]),i(`
`),s("span",{class:"line"},[s("span",null,"                          d*feats[:, 7])")]),i(`
`),s("span",{class:"line"},[s("span",null,"    ")]),i(`
`),s("span",{class:"line"},[s("span",null,"    return feats_interp")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"if __name__ == '__main__':")]),i(`
`),s("span",{class:"line"},[s("span",null,"    N = 65536 ")]),i(`
`),s("span",{class:"line"},[s("span",null,"    F = 256")]),i(`
`),s("span",{class:"line"},[s("span",null,"    feats = torch.rand(N, 8, F, device='cuda')")]),i(`
`),s("span",{class:"line"},[s("span",null,"    points = torch.rand(N, 3, device='cuda') * 2 - 1")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"    t = time.time()")]),i(`
`),s("span",{class:"line"},[s("span",null,"    out_cuda = cppcuda_tutorial._trilinear_interpolation(feats, points)")]),i(`
`),s("span",{class:"line"},[s("span",null,"    torch.cuda.synchronize()")]),i(`
`),s("span",{class:"line"},[s("span",null,"    print('   cuda fw time', time.time()-t, 's')")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"    t = time.time()")]),i(`
`),s("span",{class:"line"},[s("span",null,"    out_py = trilinear_interpolation_py(feats, points)")]),i(`
`),s("span",{class:"line"},[s("span",null,"    torch.cuda.synchronize()")]),i(`
`),s("span",{class:"line"},[s("span",null,"    print('pytorch fw time', time.time()-t, 's')")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"    out_cuda = cppcuda_tutorial._trilinear_interpolation(feats, points)")]),i(`
`),s("span",{class:"line"},[s("span",null,"    out_py = trilinear_interpolation_py(feats, points)")]),i(`
`),s("span",{class:"line"},[s("span",null,"    # 判断是否相等")]),i(`
`),s("span",{class:"line"},[s("span",null,"    print(torch.allclose(out_py, out_cuda))")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"tutorial-6-反向传播",tabindex:"-1"},[i("Tutorial 6 反向传播 "),s("a",{class:"header-anchor",href:"#tutorial-6-反向传播","aria-label":'Permalink to "Tutorial 6 反向传播"'},"​")],-1),s("p",null,"检查能否自动计算梯度",-1),s("div",{class:"language-python"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"python"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"torch.requires_grad(out_cuda)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," false")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"因此我们需要手写反向传播",-1),s("p",null,[i("step1：计算所有"),s("strong",null,"output"),i("对所有"),s("strong",null,"trainable input"),i("的偏微分")],-1),s("p",null,"step2： 用torch.autograd.Function包装fw及bw处理",-1),s("div",{class:"language-c++"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"c++"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"class"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Trilinear_interpolation_cuda"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"torch"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"autograd"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"Function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"):")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @staticmethod")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    def"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," forward"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ctx"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"feats"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"points"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"):")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        feat_interp "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cppcuda_tutorial."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"trilinear_interpolation_fw"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(feats, points)")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ctx."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"save_for_backward"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(feats, points)")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," feat_interp")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    # 前向传播后，dL_dfeat_interp已知，其他需要手写反向传播")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @staticmethod")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    def"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," backward"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ctx"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dL_dfeat_interp"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"):")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        feats, points "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ctx.saved_tensors")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        dL_dfeats "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cppcuda_tutorial."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"trilinear_interpolation_bw"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(dL_dfeat_interp."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"contiguous"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), feats, points)")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," dL_dfeats, None")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"写好的时候，就用apply方法，就可以保存梯度了",-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"out_cuda = Trilinear_interpolation_cuda.apply(feats2, points)")])])]),s("button",{class:"code-block-unfold-btn"})],-1)])]),"main-header":a(()=>[t(l.$slots,"main-header")]),"main-header-after":a(()=>[t(l.$slots,"main-header-after")]),"main-nav":a(()=>[t(l.$slots,"main-nav")]),"main-content-before":a(()=>[t(l.$slots,"main-content-before")]),"main-content":a(()=>[t(l.$slots,"main-content")]),"main-content-after":a(()=>[t(l.$slots,"main-content-after")]),"main-nav-before":a(()=>[t(l.$slots,"main-nav-before")]),"main-nav-after":a(()=>[t(l.$slots,"main-nav-after")]),comment:a(()=>[t(l.$slots,"comment")]),footer:a(()=>[t(l.$slots,"footer")]),aside:a(()=>[t(l.$slots,"aside")]),"aside-custom":a(()=>[t(l.$slots,"aside-custom")]),default:a(()=>[t(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{L as default,B as usePageData};
